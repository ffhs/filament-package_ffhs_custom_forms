function f(t){return t._x_dataStack===void 0?{}:Alpine.mergeProxies(t._x_dataStack)}function h(t){return f(t).group??null}function p(t){let e=f(t);return e===null?null:e.element??null}function E(t){return f(t).element!==null}function N(t){return f(t).parent??!1}function A(t){return f(t).container??!1}function J(t){return f(t).drag??!1}function K(t){return x(t)!==null}function x(t){return f(t).action??null}function P(){return document.querySelector("[ffhs_drag\\:dragging]")}function l(t){let e=t;for(;e&&!(e instanceof Document);){if(e.hasAttribute("ffhs_drag:component")&&N(e))return e;e=e.parentNode}return null}function b(t,e){let r=h(t);if(r===void 0)return!1;let n=h(e);return n===void 0?!1:r===n}function w(t,e=r=>J(r)||A(r)){let r=t;for(;r&&!(r instanceof Document);){if(e(r))return r;r=r.parentNode}return null}function m(t,e,r){if(!e[`__has_${t}`]){let n=i=>r(i);e.addEventListener(t,n),e[`__has_${t}`]=!0}}function j(t,e){let r=P();r!=null&&b(r,t)&&(l(t)?.getAttribute("disabled")||(e.stopPropagation(),e.preventDefault(),!(!A(t)&&p(t)===p(r))&&setTimeout(()=>{t.setAttribute("ffhs_drag:hower_over",!0)},0)))}function z(t){P()!=null&&(t.preventDefault(),t.stopPropagation(),v())}function O(t){m("dragenter",t,e=>j(t,e)),m("dragleave",t,e=>z(e)),m("dragover",t,e=>e.preventDefault())}function v(){document.querySelectorAll("*").forEach(t=>{t.removeAttribute("ffhs_drag:hower_over")})}function _(t,e){E(t)?t.before(e):A(t)&&t.insertBefore(e,t.firstChild)}function G(t,e){if(p(t)===null)return!1;let n=l(t);return f(n).statePath===e.statePath}function H(t,e){let r=0;return t.querySelectorAll("[ffhs_drag\\:component]").forEach(n=>{G(n,e)&&r++}),r}function M(t,e,r,n){let i=1,s=n.dragDropPosAttribute,d=n.dragDropEndPosAttribute,u=crypto.randomUUID().split("-"),g=u[0]+u[1];e.querySelectorAll("[ffhs_drag\\:component]").forEach(o=>{if(!G(o,n))return;let a=p(o),c=H(o,n);t[a]===void 0&&(t[a]={}),t[a][s]=i,t[a][d]=c===0?null:i+c,i++})}function Q(t,e,r,n){let i=1,s=n.orderAttribute,d=l(e);e.querySelectorAll("[ffhs_drag\\:component]").forEach(u=>{let g=p(u);if(!g||h(u)!==r)return;let o=l(u);d===o&&(t[g]===void 0&&(t[g]={}),t[g][s]=i,i++)})}function D(t,e,r,n){n.flatten?M(t,e,r,n):n.orderAttribute!==null&&Q(t,e,r,n)}function $(t,e){let r=l(t),n=f(r),i=n.wire.get(n.statePath,"");(!i||Array.isArray(i))&&(i={});let s=h(r),d=l(e),u=d===r;if(r.getAttribute("disabled"))return;if(_(t,e),!u){let o=f(d),a=o.wire.get(o.statePath,"");(!a||Array.isArray(a))&&(a={});let c=p(e);i[c]=a[c],delete a[c],D(a,d,s,o),o.wire.set(o.statePath,a,!1)}if(D(i,r,s,n),r.getAttribute("disabled"))return;let g=!u||n.isLive;n.wire.set(n.statePath,i,g)}function R(t,e,r){let n=document.createElement("span");return n.setAttribute("x-data",`dragDropElement('${t}','${e}')`),n.setAttribute("ffhs_drag:component",null),n.classList.add("hidden"),_(r,n),Alpine.initTree(n),n}function V(){let t=crypto.randomUUID().split("-");return t[0]+t[1]}function W(t,e,r,n){return t?e[r][n.dragDropPosAttribute]:e[r][n.orderAttribute]}function I(t,e){let r=l(t),n=h(r),i=f(r),s=i.flatten,d=i.wire,u=d.get(i.statePath,"");if(Array.isArray(u)&&(u={}),r.getAttribute("disabled"))return;let g=p(t),o=V(),a=R(n,o,t),c=JSON.parse(JSON.stringify(u));D(c,r,n,i);let F=W(s,c,o,i),y=null,S=null;s&&(y=w(a.parentNode,B=>E(B))),y&&(S=p(y));let C=x(e),U=C.split("'")[1],q=C.split("'")[3];if(r.getAttribute("disabled"))return;let L={targetPath:i.statePath,position:F,flatten:s,targetIn:S,target:g};d.mountFormComponentAction(U,q,L)}function T(t){m("drop",t,e=>{e.stopPropagation(),e.preventDefault();let r=P();r!=null&&r!==t&&b(r,t)&&(l(t).getAttribute("disabled")||(v(),K(r)?I(t,r):$(t,r)))})}function k(t){m("dragstart",t,e=>{e.stopPropagation();let r=l(t);r!==null&&r.getAttribute("disabled")||t.setAttribute("ffhs_drag:dragging",!0)}),t.addEventListener("dragend",e=>{e.stopPropagation(),t.removeAttribute("ffhs_drag:dragging")})}function X(t,e){return{group:t,element:e,drag:!0,parent:!1,action:null,container:!1,init(){k(this.$el),O(this.$el),T(this.$el)}}}export{X as default};
