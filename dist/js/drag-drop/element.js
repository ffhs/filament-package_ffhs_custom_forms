function f(t){return t._x_dataStack===void 0?{}:Alpine.mergeProxies(t._x_dataStack)}function h(t){return f(t).group??null}function s(t){let e=f(t);return e===null?null:e.element??null}function w(t){let e=f(t);return e.element!==null&&e.element!==void 0}function J(t){return f(t).parent??!1}function P(t){return f(t).container??!1}function C(t){return D(t)!==null}function D(t){return f(t).action??null}function A(){return document.querySelector("[ffhs_drag\\:dragging]")}function l(t){let e=t;for(;e&&!(e instanceof Document);){if(e.hasAttribute("ffhs_drag:component")&&J(e))return e;e=e.parentNode}return null}function E(t,e){let r=h(t);if(r===void 0)return!1;let n=h(e);return n===void 0?!1:r===n}function g(t,e,r){if(!e[`__has_${t}`]){let n=o=>r(o);e.addEventListener(t,n),e[`__has_${t}`]=!0}}function N(t,e){let r=A();r!=null&&E(r,t)&&(l(t)?.getAttribute("disabled")||(e.stopPropagation(),e.preventDefault(),!(!P(t)&&s(t)===s(r))&&setTimeout(()=>{t.setAttribute("ffhs_drag:hower_over",!0)},0)))}function U(t){A()!=null&&(t.preventDefault(),t.stopPropagation(),y())}function O(t){g("dragenter",t,e=>N(t,e)),g("dragleave",t,e=>U(e)),g("dragover",t,e=>e.preventDefault())}function y(){document.querySelectorAll("*").forEach(t=>{t.removeAttribute("ffhs_drag:hower_over")})}function x(t,e){w(t)?t.before(e):P(t)&&t.prepend(e)}function G(t,e){if(s(t)===null)return!1;let n=l(t);return f(n).statePath===e.statePath}function k(t,e){let r=0;return t.querySelectorAll("[ffhs_drag\\:component]").forEach(n=>{G(n,e)&&r++}),r}function B(t,e,r,n){let o=1,d=n.dragDropPosAttribute,p=n.dragDropEndPosAttribute;e.querySelectorAll("[ffhs_drag\\:component]").forEach(i=>{if(!G(i,n))return;let u=s(i),a=k(i,n);t[u]===void 0&&(t[u]={}),t[u][d]=o,t[u][p]=a===0?null:o+a,o++})}function I(t,e,r,n){let o=1,d=n.orderAttribute,p=l(e);e.querySelectorAll("[ffhs_drag\\:component]").forEach(i=>{let u=s(i);if(!u||h(i)!==r)return;let a=l(i);p===a&&(t[u]===void 0&&(t[u]={}),t[u][d]=o,o++)})}function b(t,e,r,n){n.flatten?B(t,e,r,n):n.orderAttribute!==null&&I(t,e,r,n)}function $(t,e){let r=l(t),n=f(r),o=n.wire.get(n.statePath,"");(!o||Array.isArray(o))&&(o={});let d=h(r),p=l(e),i=p===r;if(r.getAttribute("disabled"))return;if(x(t,e),!i){let a=f(p),c=a.wire.get(a.statePath,"");(!c||Array.isArray(c))&&(c={});let m=s(e);o[m]=c[m],delete c[m],b(c,p,d,a),a.wire.set(a.statePath,c,!1)}if(b(o,r,d,n),r.getAttribute("disabled"))return;let u=!i||n.isLive;n.wire.set(n.statePath,o,u)}function W(t,e,r){let n=document.createElement("div");return n.setAttribute("x-data",`typeof dragDropElement === 'undefined'? {}: dragDropElement('${t}','${e}')`),n.setAttribute("ffhs_drag:component",null),n.classList.add("hidden"),x(r,n),Alpine.initTree(n),n}function j(){let t=crypto.randomUUID().split("-");return t[0]+t[1]}function z(t,e,r,n){return t?e[r]===void 0?1:e[r][n.dragDropPosAttribute]??1:e[r]===void 0?1:e[r][n.orderAttribute]??1}function F(t,e){let r=l(t),n=h(r),o=f(r),d=o.flatten,p=o.wire,i=p.get(o.statePath,"");if(Array.isArray(i)&&(i={}),r.getAttribute("disabled"))return;let u=s(t),a=j(),c=W(n,a,t),m=JSON.parse(JSON.stringify(i));b(m,r,n,o);let L=z(d,m,a,o),v=D(e),_=v.split("'")[1],S=v.split("'")[3];if(r.getAttribute("disabled"))return;let K={targetPath:o.statePath,position:L,flatten:d,target:u,stateWithField:m,temporaryKey:a,state:JSON.parse(JSON.stringify(i))};console.log(_),console.log(S),console.log(K),p.mountFormComponentAction(_,S,K)}function T(t){g("drop",t,e=>{e.stopPropagation(),e.preventDefault();let r=A();r!=null&&r!==t&&E(r,t)&&(l(t).getAttribute("disabled")||(y(),C(r)?F(t,r):$(t,r)))})}function q(t){g("dragstart",t,e=>{e.dataTransfer.setData("text/plain",null),e.stopPropagation();let r=l(t);r!==null&&r.getAttribute("disabled")||t.setAttribute("ffhs_drag:dragging",!0)}),t.addEventListener("dragend",e=>{e.stopPropagation(),t.removeAttribute("ffhs_drag:dragging")})}function H(t,e){return{group:t,element:e,drag:!0,parent:!1,action:null,container:!1,init(){q(this.$el),O(this.$el),T(this.$el)}}}export{H as default};
