function f(t){return t._x_dataStack===void 0?{}:Alpine.mergeProxies(t._x_dataStack)}function m(t){return f(t).group??null}function p(t){let e=f(t);return e===null?null:e.element??null}function A(t){let e=f(t);return e.element!==null&&e.element!==void 0}function B(t){return f(t).parent??!1}function P(t){return f(t).container??!1}function J(t){return f(t).drag??!1}function C(t){return v(t)!==null}function v(t){return f(t).action??null}function E(){return document.querySelector("[ffhs_drag\\:dragging]")}function a(t){let e=t;for(;e&&!(e instanceof Document);){if(e.hasAttribute("ffhs_drag:component")&&B(e))return e;e=e.parentNode}return null}function b(t,e){let r=m(t);if(r===void 0)return!1;let n=m(e);return n===void 0?!1:r===n}function K(t,e=r=>J(r)||P(r)){let r=t;for(;r&&!(r instanceof Window);){if(console.log("par-search"),console.log(r),console.log(e(r)),e(r))return console.log(A(r)),console.log(p(r)),r;r=r.parentNode}return null}function c(t,e,r){if(!e[`__has_${t}`]){let n=o=>r(o);e.addEventListener(t,n),e[`__has_${t}`]=!0}}function W(t,e){let r=E();r!=null&&b(r,t)&&(a(t)?.getAttribute("disabled")||(e.stopPropagation(),e.preventDefault(),!(!P(t)&&p(t)===p(r))&&setTimeout(()=>{t.setAttribute("ffhs_drag:hower_over",!0)},0)))}function j(t){E()!=null&&(t.preventDefault(),t.stopPropagation(),_())}function O(t){c("dragenter",t,e=>W(t,e)),c("dragleave",t,e=>j(e)),c("dragover",t,e=>e.preventDefault())}function _(){document.querySelectorAll("*").forEach(t=>{t.removeAttribute("ffhs_drag:hower_over")})}function S(t,e){A(t)?t.before(e):P(t)&&t.prepend(e)}function G(t,e){if(p(t)===null)return!1;let n=a(t);return f(n).statePath===e.statePath}function z(t,e){let r=0;return t.querySelectorAll("[ffhs_drag\\:component]").forEach(n=>{G(n,e)&&r++}),r}function H(t,e,r,n){let o=1,d=n.dragDropPosAttribute,s=n.dragDropEndPosAttribute;e.querySelectorAll("[ffhs_drag\\:component]").forEach(i=>{if(!G(i,n))return;let l=p(i),u=z(i,n);t[l]===void 0&&(t[l]={}),t[l][d]=o,t[l][s]=u===0?null:o+u,o++})}function M(t,e,r,n){let o=1,d=n.orderAttribute,s=a(e);e.querySelectorAll("[ffhs_drag\\:component]").forEach(i=>{let l=p(i);if(!l||m(i)!==r)return;let u=a(i);s===u&&(t[l]===void 0&&(t[l]={}),t[l][d]=o,o++)})}function D(t,e,r,n){n.flatten?H(t,e,r,n):n.orderAttribute!==null&&M(t,e,r,n)}function T(t,e){let r=a(t),n=f(r),o=n.wire.get(n.statePath,"");(!o||Array.isArray(o))&&(o={});let d=m(r),s=a(e),i=s===r;if(r.getAttribute("disabled"))return;if(S(t,e),!i){let u=f(s),g=u.wire.get(u.statePath,"");(!g||Array.isArray(g))&&(g={});let h=p(e);o[h]=g[h],delete g[h],D(g,s,d,u),u.wire.set(u.statePath,g,!1)}if(D(o,r,d,n),r.getAttribute("disabled"))return;let l=!i||n.isLive;n.wire.set(n.statePath,o,l)}function Q(t,e,r){let n=document.createElement("div");return n.setAttribute("x-data",`typeof dragDropElement === 'undefined'? {}: dragDropElement('${t}','${e}')`),n.setAttribute("ffhs_drag:component",null),n.classList.add("hidden"),S(r,n),Alpine.initTree(n),n}function R(){let t=crypto.randomUUID().split("-");return t[0]+t[1]}function V(t,e,r,n){return t?e[r]===void 0?1:e[r][n.dragDropPosAttribute]??1:e[r]===void 0?1:e[r][n.orderAttribute]??1}function $(t,e){let r=a(t),n=m(r),o=f(r),d=o.flatten,s=o.wire,i=s.get(o.statePath,"");if(Array.isArray(i)&&(i={}),r.getAttribute("disabled"))return;let l=p(t),u=R(),g=Q(n,u,t),h=JSON.parse(JSON.stringify(i));D(h,r,n,o);let q=V(d,h,u,o),x=null,y=null;d&&(x=K(g.parentNode,k=>A(k))),x&&(y=p(x.parentNode));let w=v(e),L=w.split("'")[1],N=w.split("'")[3];if(r.getAttribute("disabled"))return;console.log(y,"??");let U={targetPath:o.statePath,position:q,flatten:d,targetIn:y,target:l};s.mountFormComponentAction(L,N,U)}function F(t){c("drop",t,e=>{e.stopPropagation(),e.preventDefault();let r=E();r!=null&&r!==t&&b(r,t)&&(a(t).getAttribute("disabled")||(_(),C(r)?$(t,r):T(t,r)))})}function I(t){c("dragstart",t,e=>{e.dataTransfer.setData("text/plain",null),e.stopPropagation();let r=a(t);r!==null&&r.getAttribute("disabled")||t.setAttribute("ffhs_drag:dragging",!0)}),t.addEventListener("dragend",e=>{e.stopPropagation(),t.removeAttribute("ffhs_drag:dragging")})}function X(t,e){return{group:t,element:e,drag:!0,parent:!1,action:null,container:!1,init(){I(this.$el),O(this.$el),F(this.$el)}}}export{X as default};
